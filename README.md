# my-project

## SmartCity : Traffic control module


1) 개발 개요 
- 개발 배경 및 필요성

1-1. 문제 인식
 서울을 비롯한 대도시에는 인구가 지속적으로 몰리면서 자연스럽게 차량 통행량 또한 증가하는 추세다. 정부에서는 대중교통 이용을 장려하고 있지만, 여전히 많은 사람들이 개인 차량을 이용하고 있는 실정이다. 이로 인해 서울과 부산 등 주요 도시의 혼잡 비율이 계속 증가하고 있으며, 이는 시간과 경제적 손실로 이어지고 있다.

     <서울시 전년대비 교통량 현황 및 분석>                


2) 개발품의 필요성 및 목적

 현재 대부분의 교통 신호등은 고정된 주기로 운영되고 있다. 차량이 많거나 유동인구가 많은 지역의 경우 다른 지역에 비해 신호 주기를 길게 설정하고 있지만, 이는 평균적인 교통량을 기준으로 한 것이기 때문에 실제 교통 상황을 제대로 반영하지 못하는 한계가 있고 실제로 출퇴근 시간이나 주말과 같이 시간대별로 교통량이 급격히 증가하는 경우가 많이 있다. 


  <시간대별 교통량 추이>

 이런 상황에서 현재의 고정된 신호 주기로는 효율적인 교통 소통을 보장할 수 없다. 만약 영상 분석을 통한 실시간 교통량 데이터를 활용하여 신호 주기를 동적으로 조정한다면, 교통 혼잡을 크게 줄일 수 있을 것이다.
                           
 또한, 구급차나 소방차와 같은 긴급 차량이 출동할 때에도 일반 차량 신호와 별도로 제어할 수 있다면 보다 신속한 대응이 가능할 것이다. 이처럼 실시간 교통 상황에 맞춰 능동적으로 
신호를 제어한다면 많은 이점이 있을 것이다.

 따라서 본 프로젝트에서는 딥러닝 기반의 영상 분석과 객체 인식 데이터를 활용하여 실시간 교통량을 파악하고, 이를 바탕으로 신호 주기를 동적으로 조정하는 시스템을 개발하고자 한다. 이를 통해 교통 흐름을 개선하고 체증을 완화할 수 있을 것으로 기대된다. 개발품의 목적은 다음과 같다.

가. 카메라를 통해 객체 탐지                        나. 탐지된 객체 중에 자동차만 검출
다. 카메라를 통해 받은 데이터를 서버로 전송        라. 전송된 데이터로 신호 주기 제어 

































작품 설명

1) 개발품의 해결 방안
* 해결 방안 (가,나)
 - jetson nano에 웹캠을 연결하고 작동되는지 확인
 - YOLO 모델을 통해 차량 판별
 - coco 데이터셋에 들어있는 ’car‘ 만을 검출하도록 코드 수정
 - 차량의 수를 셀 수 있는 count 변수 추가

* 해결 방안 (다)
 - 라즈베리 파이에서 Python 기반 웹서버 Flask 서버 구축
 - jetson 과 라즈베리 파이의 TCP 통신
 - Jetson nano에서 탐지된 차량의 수를 라즈베리 파이에서 구축한 Flask 서버로 전송
 - Flask 서버에서 탐지된 차량의 수를 볼 수 있는 GUI 구현

* 해결 방안 (라)
 - Arduino 모듈을 통해 LED3개로 이루어진 신호등 모듈 4개 제작
 - Flask 서버에서 Arduino와 시리얼 통신
 - Flask 서버에서 신호를 받아 Arduino 신호등 모듈 제어
 - ArduinoIDE에서 신호등 모듈 순차적 제어

2) 전체 시스템 구성
 * 전체 시스템 구성도


Raspberry pi


Jetson nano

Arduino Uno





Serial








* 개발 환경 및 툴 이미지


개발 보드



보드 이름
Jetson nano Develop kit
Raspberry Pi 4
Model B 4GB
Arduino Uno
개발 언어


중요 라이브러리
opencv/pytorch/requests
pyserial/Flask
Serial.begin
사용 시스템

















* 부품 리스트




번호
품명
이미지
링크
1
Jetson nano Develop kit

NVIDIA® Jetson Orin™ Nano Developer Kit [102110839] / 디바이스마트 (devicemart.co.kr)
2
Raspberry Pi 4
Model B 4GB

라즈베리파이4 (4GB) 스타터 키트 + 가이드북 / 디바이스마트 (devicemart.co.kr)
3
Arduino Uno

아두이노 우노 R3 고급 키트(매뉴얼 포함) / 디바이스마트 (devicemart.co.kr)
4
pleomax w-210

쿠팡! | 플레오맥스 화상카메라 W-210 (coupang.com)
5
Raspberry Pi Touch Display

라즈베리파이 공식 7인치 터치스크린 (Raspberry Pi Touch Display) / 디바이스마트 (devicemart.co.kr)










3) 부분별 주요 동작 및 특징

3-1. jetson nano를 사용한 YOLOv5의 차량 탐지
(1)  서버와의 TCP 연결




(2)　YOLOv5 모델을 사용해 차량 탐지후 탐지된 차량의 수를 서버로 전송


다양한 YOLO 모델이 출시되었고, 버전이 높을수록 성능은 좋아졌지만 메모리를 많이 쓰게 되는 단점이 생김, 이번 웹캠을 사용한 차량 탐지에 사용되는 Jetson nano develop kit에서는 메모리 문제로 좋은 성능을 내는 높은 버전의 YOLO 사용이 제한되었기 때문에 가볍게 사용할 수 있는 YOLOv5 모델을 선택하게 되었다.


그중에서도 가장 메모리를 적게 차지하는 모델 YOLOv5n 선택,



Jetson nano에서 웹캠과 YOLOv5n 모델을 사용해 차량을 탐지하고 탐지된 차량의 수를 구해 서버로 전달

3-2. 라즈베리 파이에서 구현하는 Flask 서버
(1) 탐지된 차량의 수를 볼 수 있는 GUI 구축 :　html










(2) Arduino와 서버 간의 시리얼 통신


아두이노와 라즈베리 파이의 시리얼 통신. Flask 라이브러리를 통해 라즈베리 파이에서 서버를 열고 아두이노와의 포트 번호, 전송속도 등을 맞춘 후 시리얼 통신 시작



탐지된 차량의 수가 임곗값을 넘지 못하면 normal 신호가 아두이노로 들어오고, 임곗값을 넘을 때 extend 신호가 들어온다.


3-3. Arduino를 사용한 신호 모듈 제어
(1) 신호등 모듈 제어



실제 사거리의 신호등 4개를 따라 하기 위해 빨강, 노랑, 초록 3가지의 LED를 하나의 신호등으로 12개의 LED를 사용해 4개의 신호등을 정의함.


4개의 신호등을 1~4번의 번호를 붙여 정의하였고, 신호등의 번호를 이용해 4개의 신호등을   순차적으로 동작할 수 있게 설계함.
(2) Flask 서버에서 받은 extend 신호로 신호등 모듈 제어



서버에서 extend 신호가 아두이노로 전달되면, 

아두이노는 초록불의 신호를 증가시키는 함수를 불러와서 1번 신호등의 초록불 신호를 증가시킴

#　원래 계획은 4개의 캠을 사용해 각각의 도로 위 차량을 탐지 >>> 교통 혼잡도를 계산하고 사거리 중 가장 교통 혼잡도가 심한 곳부터 초록불의 신호를 증가시켜 교통 혼잡을 해소하고자 했음. 그러나 사용 중인 jetson nano가 여러 개의 웹캠과 YOLO 모델을 돌리기에는 턱없이 부족했음

하나의 웹캠으로 구현하고자 하던 기능을 보여주기 위해, 신호등 4개 중 1번 신호등을 기준으로 실험을 시작. extend 신호를 받은 신호등 1번 모듈은 초록불을 5초 증가시켰고 나머지 2,3,4번 신호등은 정상적으로 기존 초록불의 시간만큼 동작함, 그 후 extend 신호가 끊기고 normal 신호가 들어올 때 신호등 1번 모듈의 초록불 또한 정상적인 시간으로 동작함을 확인함.










(3)순서도




작품 결론
1) 최종 시연
첨부파일 확인.
<1번 영상> normal 상태에서 차량의 수가 임곗값을 넘어갈때 extend 신호를 받고 초록색 신호가 설정값만큼 증가되는 영상

<2번 영상> extend 신호를 받고 신호가 증가된 상태에서 서버가 보내는 normal 신호를 받고 extend 상태를 해제하여 다시 초기값으로 돌아가는 영상


2) 가져올 변화   
1. 교통 체증 완화

- 차량 수에 따라 신호를 조절하여 교통 체증을 완화할 수 있다. 차량이 많이 모이는 구간에서 신호를 추가하여 더 긴 시간 동안 차량이 이동할 수 있도록 할 수 있고, 차량이 적은 구간에서는 반대로 신호를 감소시켜 교통체증을 완화한다. 예를 들어 출퇴근 시간 등과 같은 한 번에 차량이 많이 모일 때 차량이 많이 통과하는 구간이 있을 것이고 반대로 차량의 통행이 적은 구간이 있을 것이다. 그때 신호를 차량의 수에 따라 유동적으로 제어할 수 있다면 차량 이동이 조금 더 편해질 것이다. 

2. 환경보호 

- 차량이 적은 구간에서 신호 대기를 최소화하여 에너지 소비를 줄이고, 환경을 보호할 수 있다. 실제로 교통 체증으로 인한 차량의 정체는 주행 중에 매연을 발생시키는 주요 원인 중 하나이다. 교통 흐름을 최적화하여 차량이 원활하게 이동하도록 조절함으로써 차량이 발생하는 매연을 줄일 수 있을 것이다. 특히 차량이 많이 통과하는 구간에서 차량의 정체는 엔진의 부담과 이어져 매연 발생량이 늘어날 것인데 이를 해소함으로써 환경보호에 긍정적인 영향을 끼칠 수 있을 것이다. 

3. 소음 감소

- 교통 체증은 도로 위의 주행 차량들 사이의 공간을 좁히고, 차량들이 추월하며 경적을 울리는 상황을 발생시킨다. 이는 도심에서 소음을 증가시키는 주요 원인 중 하나이다. 교통 흐름을 최적화하여 차량이 원활하게 이동하고 교통체증이 감소되면 자연스레 차량들의 추월과 경적을 울리는 횟수가 줄어들 것이다. 

4. 운전자 편의성

- 차량이 막히지 않고 빠르게 움직일수 있고, 신호 대기시간이 최소화되면 운전자들의 스트레스가 줄어들고 운전 경험이 개선된다. 이는 운전자의 만족도를 향상시키고 도시의 교통 시스템에 대한 긍정적인 인식을 조성할 수 있다. 

5. 안전성

- 교통 흐름을 최적화하고 교통 체증을 해결한다면 교통사고의 발생 가능성 또한 줄일 수 있을 것이다.  




3) 차후 계획

1. 긴급 차량에 대한 우선 신호

- 소방차, 경찰차, 구급차 등 긴급 차량이 카메라에 탐지되면 곧바로 모든 방향의 신호등이 적색불을 켜고, 긴급차량의 진행 방향을 확인하여 신호를 제어할  수있다. 그로 인해 위급 상황에 대한 대처가 신속하고 안전하게 이루어질 수 있다.


2. GPS 기반 경로 안내

- 탐지된 차량의 수가 임곗값을 넘어가 교통 혼잡을 야기할 수 있다 판단되면, GPS 기반 경로 안내 시스템을 통해 운전자들에게 최적의 경로를 선택할 수 있도록 지원한다.

3. DB 추가

 -실시간 교통 데이터를 수집하고 데이터베이스에 저장하여 분석할 수 있도록 할 예정이다. 데이터베이스에 누적된 정보를 활용하면 보다 정교한 신호 제어 알고리즘을 개발할 수 있을 것이다. 또한 차량 배기가스 저감 효과를 정량적으로 분석하여 환경 개선 성과를 가시적으로 확인하고, 시스템 최적화에 활용할 수 있을 것으로 기대된다. 데이터 기반의 지능형 신호 제어 시스템 구축을 통해 교통 효율성과 환경성을 한층 더 높일 수 있을 것이다.    
